

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚¹ã‚¿ãƒã‚¤ï½œVD&WDï½œã‚°ãƒƒã‚ºè³¼å…¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.4);
  pointer-events: none;
  z-index: -1;
}

body {
background: linear-gradient(
  90deg,
  rgba(77,131,177,0.35),
  rgba(71,151,90,0.35),
  rgba(233,149,37,0.35),
  rgba(113,95,155,0.35),
  rgba(169,54,59,0.35),
  rgba(119,162,169,0.35)
);
  background-attachment: fixed;
}

body { padding-bottom: 0; }

.main { padding: 12px; }

.main-title {
  text-align: center;
  padding: 18px 10px;
  background: #f8f8f8;
}
.main-title .anniv {
  display: block;
  font-size: 14px;
}

.main-title .title-main {
  display: block;
  font-size: 20px;
  font-weight: 900;
}

.note {
  display: block;
  font-size: 12px;
  color: #666;
  margin-top: 4px;
}

h2 {
  margin-top: 24px;
  font-size: 18px;
  border-left: 4px solid #84c1b1;
  padding-left: 8px;
}

/* å…±é€š */
.item {
  display: flex;
  gap: 10px;
  align-items: center;

  padding: 12px 0;
  margin: 0;
  border-bottom: 1px solid #eee;
}

.item:last-of-type {
  border-bottom: none;
}



/* ã‚­ãƒ£ãƒ©å•†å“ï¼ˆ1è¡Œå›ºå®šï¼‰ */
.label-char {
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ãƒ©ãƒ³ãƒ€ãƒ å•†å“ï¼ˆ2è¡ŒOKï¼‰ */
.label-random {
  flex: 1;
  white-space: normal;
  line-height: 1.4;
  word-break: keep-all;
}



.price {
  font-size: 12px;
  color: #666;
  margin-left: 6px;
}

input {
  width: 40px;
  text-align: center;
  font-size: 16px;
}

.qty-btn {
  width: 36px;
  height: 36px;
}

.summary-fixed {
  position: sticky;
  top: 0;
  left: 0;
  right: 0;

  background: #fff;
  border-bottom: 2px solid #84c1b1;

  padding: 10px 16px;

  display: flex;
  justify-content: space-between;
  align-items: center;

  z-index: 10;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.summary-left {
  display: flex;
  flex-direction: column;
  gap: 4px;
}


.bonus-line {
  font-size: 13px;
  color: #555;
}

.save-btn {
  background: #84c1b1;
  color: #fff;
  border: none;
  padding: 8px 14px;
}

/* ä½œæˆè€…æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.creator {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;

  font-size: 11px;
  color: #666;
  margin-top: 16px;
  margin-bottom: 32px;
  padding: 8px;
}

.creator > a { justify-self: center; }
.creator > div { justify-self: end; }


.creator-link {
  display: inline-flex;
  align-items: center;
  text-decoration: none;
  color: inherit;
  gap: 4px;
}

.creator-link svg {
  width: 14px;
  height: 14px;
  fill: currentColor;
}

.reset-btn{
  background:#e57373;
  color:#fff;
  border:none;
  padding:8px 14px;
  cursor:pointer;
}

.reset-btn:hover{
  background:#d32f2f;
}

.home-back {
  margin: 24px 0;
  text-align: center;
}

.home-link {
  display: inline-block;
  padding: 10px 18px;
  border-radius: 999px;
  background-color: #84c1b1;
  color: #fff;
  text-decoration: none;
  font-size: 14px;
  font-weight: 600;
}

.home-link:hover {
  opacity: 0.85;
}


</style>
</head>

<body>

<h1 class="main-title">
  <span class="anniv">Valentine's Day ï¼† White Day </span>
  <span class="title-main">POP UP STORE</span>
</h1>

<!-- â˜…ã“ã“ã¯åˆè¨ˆãƒãƒ¼ã ã‘ -->
<div class="summary-fixed">

  <div class="summary-left">
    <div>
      åˆè¨ˆï¼š<span id="totalQty">0</span>ç‚¹ /
      Â¥<span id="totalPrice">0</span>
    </div>

    <div class="bonus-line">
      ç‰¹å…¸ï¼š<span id="bonusCount">0</span>æš /
      æŠ½é¸ï¼š<span id="lotteryCount">0</span>å›
    </div>
  </div>

  <div style="display:flex; gap:8px;">
    <button class="save-btn" onclick="saveAsImage()">ç”»åƒã§ä¿å­˜</button>
    <button class="reset-btn" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

</div>


<!-- â˜…ã“ã“ã‹ã‚‰é€šå¸¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="main">

  <h2>â– å‰åŠå•†å“</h2>

  <h3>â—‹ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ</h3>
  <div id="chocolate"></div>

  <h3>â—‹ç­‰èº«ã‚¢ã‚¯ã‚¹ã‚¿</h3>
  <div id="BB1"></div>

  <h3>â—‹ãƒ©ãƒ³ãƒ€ãƒ å•†å“</h3>
  <div id="random_first"></div>

  <h2>â– å¾ŒåŠå•†å“</h2>

  <h3>â—‹ä¸¡é¢ãƒ­ãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼</h3>
  <div id="poster"></div>

  <h3>â—‹ãƒ©ãƒ³ãƒ€ãƒ å•†å“</h3>
  <div id="random_second"></div>

  <p class="note">â€»ğŸ«ï¼ãƒ©ãƒã‚¹ãƒˆ</p>

</div>

<script>
/* ===============================
   ã“ã“ã ã‘ç·¨é›†ã™ã‚Œã°åˆ¥ç•Œéšˆå¯¾å¿œ
   =============================== */

const PRICE = {
  chocolate: 1404,
  BB1:1320,
  poster: 1320
};

const CHARACTERS = [
  "é’å±±","ä»Šå¤§è·¯","å¤ç›®","é–¢","æ¸¡éƒ¨","ç”±äº•","è’æœ¨ç”°","æœéœ§","æœéƒ¨","è…é‡","æ¡§å±±","ç¥æ¥½","æ§™","å¤§è°·","äº¬ä»‹","èª ","ã‚«ãƒŠãƒ¡","æ¡å¶‹","ä¹æ¡","å®®ç€¬","æ–°å ‚","å¯æ„›","æ—©ä¹™å¥³","ç€¬å°¾","æ—¥å‘","å®ç”Ÿ"
  
];

const RANDOM_PRICE_FIRST = {
  "ç­‰èº«ç¼¶ãƒãƒƒã‚¸": 550,
  "ç­‰èº«ã‚¯ãƒªã‚«": 550,
  "ç­‰èº«ã‚¢ã‚¯ã‚­ãƒ¼": 880,
  "ç­‰èº«ã‚¢ã‚¯ãƒ–ãƒ­": 880,
  "SDã‚¹ãƒ†ãƒƒã‚«ãƒ¼": 440,
  "SDã‚¢ã‚¯ã‚¹ã‚¿": 880,
  "SDç¼¶ãƒãƒƒã‚¸": 440
};

const RANDOM_PRICE_SECOND = {
"ç¼¶ãƒãƒƒã‚¸":550,
"ã‚¯ãƒªã‚«":550,
"ã‚¢ã‚¯ã‚­ãƒ¼":880,
"ã‚¤ãƒ©ã‚«[ãƒãƒˆãƒªãƒ»éƒ½ç¯‰å…„å¼Ÿ]":2200,
"ã‚¤ãƒ©ã‚«[è­¦è¦–åºãƒ»ä¹æ¡å®¶]":2200,
"ã‚¤ãƒ©ã‚«[Revelãƒ»ç€¬å°¾ç ”]":2200,
"ã‚¢ã‚¯ãƒªãƒ«ã‚­ãƒ¥ãƒ¼ãƒ–":880,
"ğŸ«[ãƒãƒˆãƒªãƒ»éƒ½ç¯‰å…„å¼Ÿãƒ»ä¹æ¡å®¶]":990,
"ğŸ«[è­¦è¦–åºãƒ»Revelãƒ»ç€¬å°¾ç ”]":990,
};

/* ===============================
   ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè§¦ã‚‰ãªãã¦OKï¼‰
   =============================== */

function createGroup(targetId, prefix, price) {
  const area = document.getElementById(targetId);

  CHARACTERS.forEach(c => {
    area.innerHTML += `
      <div class="item">
        <label class="label-char">
          ${c} <span class="price">Â¥${price.toLocaleString()}</span>
        </label>

        <button class="qty-btn" onclick="changeQty('${prefix}_${c}',-1,10)">âˆ’</button>
        <input id="${prefix}_${c}"
               type="number"
               value="0"
               min="0"
               oninput="calc()">
        <button class="qty-btn" onclick="changeQty('${prefix}_${c}',1,10)">ï¼‹</button>
      </div>`;
  });
}

function saveData() {
  const data = {};
  document.querySelectorAll("input").forEach(el => {
    data[el.id] = el.value;
  });
  localStorage.setItem("purchaseMemo", JSON.stringify(data));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem("purchaseMemo") || "{}");
  Object.keys(data).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = data[id];
  });
}



function createRandom(targetId, prefix, priceObj) {
  const area = document.getElementById(targetId);

  Object.keys(priceObj).forEach(r => {
    area.innerHTML += `
      <div class="item">
        <label class="label-random">
          ${r} <span class="price">Â¥${priceObj[r].toLocaleString()}</span>
        </label>

        <button class="qty-btn" onclick="changeQty('${prefix}_${r}',-1,90)">âˆ’</button>
        <input id="${prefix}_${r}" 
               type="number" 
               value="0" 
               min="0"
               oninput="calc()">
        <button class="qty-btn" onclick="changeQty('${prefix}_${r}',1,90)">ï¼‹</button>
      </div>`;
  });
}


function changeQty(id, diff, max) {
  const el = document.getElementById(id);
  el.value = Math.max(0, Math.min(Number(el.value) + diff, max));
  calc();
}

function calc() {
  let qty = 0, price = 0;

  document.querySelectorAll("input").forEach(el => {
    const v = Math.max(0, Number(el.value) || 0);
    if (!v) return;

    qty += v;

if (el.id.startsWith("ac_"))
  price += v * PRICE.chocolate;

else if  (el.id.startsWith("bb1_"))
  price += v * PRICE.BB1;

else if (el.id.startsWith("ps_"))
  price += v * PRICE.poster;

else if (el.id.startsWith("rd1_")) {
  price += v * RANDOM_PRICE_FIRST[el.id.replace("rd1_","")];
}
else if (el.id.startsWith("rd2_")) {
  price += v * RANDOM_PRICE_SECOND[el.id.replace("rd2_","")];
}


  });

  totalQty.textContent = qty;
  totalPrice.textContent = price.toLocaleString();
    // ===== ç‰¹å…¸ãƒ»æŠ½é¸è¨ˆç®— =====
  const bonus = Math.floor(price / 3000);   // 3,000å††æ¯
  const lottery = Math.floor(price / 5000); // 5,000å††æ¯

  document.getElementById("bonusCount").textContent = bonus;
  document.getElementById("lotteryCount").textContent = lottery;
  
  saveData(); 
}

function resetAll(){

  // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
  if(!confirm("å…¨ã¦ã®å…¥åŠ›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")){
    return;
  }

  // å…¥åŠ›æ¬„ã‚’å…¨éƒ¨0ã«
  document.querySelectorAll("input").forEach(el=>{
    el.value = 0;
  });

  // ä¿å­˜ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆâ†ã“ã‚ŒãŒæœ¬ä½“ï¼‰
  localStorage.removeItem("purchaseMemo");

  // å†è¨ˆç®—
  calc();
}


function saveAsImage() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  let firstLines = [];
  let secondLines = [];
  let firstSubtotal = 0;
  let secondSubtotal = 0;

  // ===== å•†å“é›†è¨ˆ =====
  document.querySelectorAll("input").forEach(el => {
    const q = Number(el.value);
    if (!q) return;

    const label = el.closest(".item").querySelector("label");
    const name = label.childNodes[0].textContent.trim();

    let unit = 0;

    if (el.id.startsWith("ac_")) {
      unit = PRICE.chocolate;
      firstSubtotal += unit * q;
      firstLines.push(`${name} Ã—${q}ã€€Â¥${(unit*q).toLocaleString()}`);
    }
    else if (el.id.startsWith("bb1_")) {
      unit = PRICE.BB1;
      firstSubtotal += unit * q;
      firstLines.push(`${name} Ã—${q}ã€€Â¥${(unit*q).toLocaleString()}`);
    }
    else if (el.id.startsWith("rd1_")) {
      unit = RANDOM_PRICE_FIRST[el.id.replace("rd1_","")];
      firstSubtotal += unit * q;
      firstLines.push(`${name} Ã—${q}ã€€Â¥${(unit*q).toLocaleString()}`);
    }
    else if (el.id.startsWith("ps_")) {
      unit = PRICE.poster;
      secondSubtotal += unit * q;
      secondLines.push(`${name} Ã—${q}ã€€Â¥${(unit*q).toLocaleString()}`);
    }
    else if (el.id.startsWith("rd2_")) {
      unit = RANDOM_PRICE_SECOND[el.id.replace("rd2_","")];
      secondSubtotal += unit * q;
      secondLines.push(`${name} Ã—${q}ã€€Â¥${(unit*q).toLocaleString()}`);
    }
  });

  // ===== åˆè¨ˆãƒ»ç‰¹å…¸è¨ˆç®— =====
  const totalQtyValue = Number(totalQty.textContent);
  const totalPriceValue = Number(totalPrice.textContent.replace(/,/g,""));

  const bonusCount = Math.floor(totalPriceValue / 3000);
  const lotteryCount = Math.floor(totalPriceValue / 5000);

  const lines = [
    "Valentine's Day & White Day",
    "POP UP STORE",
    "RED_LINE"
  ];

  if (firstLines.length) {
    lines.push("â– å‰åŠå•†å“", ...firstLines, "SUBTOTAL_FIRST");
  }

  if (secondLines.length) {
    lines.push("â– å¾ŒåŠå•†å“", ...secondLines, "SUBTOTAL_SECOND");
  }

  lines.push("RED_LINE");
  lines.push("FINAL_BLOCK");

  // ===== æ¨ªå¹…è¨ˆç®— =====
  let maxTextWidth = 0;

  lines.forEach(line => {
    if (line === "RED_LINE" || line === "FINAL_BLOCK") return;

    ctx.font =
      line === "POP UP STORE" ? "bold 22px sans-serif" :
      line.startsWith("â– ") || line.includes("å°è¨ˆ") ? "bold 18px sans-serif" :
      "18px sans-serif";

    const text =
      line === "SUBTOTAL_FIRST" ? `å‰åŠå°è¨ˆï¼šÂ¥${firstSubtotal.toLocaleString()}` :
      line === "SUBTOTAL_SECOND" ? `å¾ŒåŠå°è¨ˆï¼šÂ¥${secondSubtotal.toLocaleString()}` :
      line;

    const w = ctx.measureText(text).width;
    if (w > maxTextWidth) maxTextWidth = w;
  });

  const sidePadding = 60;
  canvas.width = Math.ceil(maxTextWidth + sidePadding);

  // ===== é«˜ã•è¨ˆç®— =====
  let height = 50;

  lines.forEach((line, i) => {
    if (i === 0) height += 26;
    else if (i === 1) height += 24;
    else if (line === "RED_LINE") height += 24;
    else if (line === "SUBTOTAL_FIRST" || line === "SUBTOTAL_SECOND") height += 44;
    else if (line === "FINAL_BLOCK") height += 70;
    else if (!line.startsWith("â– ")) height += 28;
    else height += 26;
  });

  canvas.height = height + 40;

  // ===== æç”»é–‹å§‹ =====
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#000";

  let y = 50;

  lines.forEach((line, i) => {

    if (i === 0) {
      ctx.font = "16px sans-serif";
      ctx.fillText(line, 30, y);
      y += 26;
      return;
    }

    if (i === 1) {
      ctx.font = "bold 22px sans-serif";
      ctx.fillText(line, 30, y);
      y += 24;
      return;
    }

    if (line === "RED_LINE") {
      y += 6;
      ctx.strokeStyle = "#84c1b1";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(30, y);
      ctx.lineTo(canvas.width - 30, y);
      ctx.stroke();
      y += 18;
      return;
    }

    if (line === "SUBTOTAL_FIRST" || line === "SUBTOTAL_SECOND") {
      y += 6;
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(30, y);
      ctx.lineTo(canvas.width - 30, y);
      ctx.stroke();

      y += 18;
      ctx.font = "bold 18px sans-serif";

      const subtotal =
        line === "SUBTOTAL_FIRST" ? firstSubtotal : secondSubtotal;

      const label =
        line === "SUBTOTAL_FIRST" ? "å‰åŠå°è¨ˆ" : "å¾ŒåŠå°è¨ˆ";

      ctx.fillText(`${label}ï¼šÂ¥${subtotal.toLocaleString()}`, 30, y);
      y += 36;
      return;
    }

    if (line === "FINAL_BLOCK") {

      y += 10;
      ctx.font = "bold 18px sans-serif";

      const leftX = 30;
      const rightMargin = 30;

      const bonusText = `ç‰¹å…¸ï¼š${bonusCount}æš`;
      const lotteryText = `æŠ½é¸ï¼š${lotteryCount}å›`;

      const bonusX = canvas.width - rightMargin - ctx.measureText(bonusText).width;
      const lotteryX = canvas.width - rightMargin - ctx.measureText(lotteryText).width;

      // 1è¡Œç›®
      ctx.fillText(`åˆè¨ˆç‚¹æ•°ï¼š${totalQtyValue}`, leftX, y);
      ctx.fillText(bonusText, bonusX, y);

      y += 30;

      // 2è¡Œç›®
      ctx.fillText(`åˆè¨ˆé‡‘é¡ï¼šÂ¥${totalPriceValue.toLocaleString()}`, leftX, y);
      ctx.fillText(lotteryText, lotteryX, y);

      y += 40;
      return;
    }

    if (!line.startsWith("â– ")) {
      ctx.font = "18px sans-serif";
      ctx.fillText(line, 30, y);

      y += 8;
      ctx.strokeStyle = "#ddd";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(30, y);
      ctx.lineTo(canvas.width - 30, y);
      ctx.stroke();

      y += 20;
      return;
    }

    ctx.font = "bold 18px sans-serif";
    ctx.fillText(line, 30, y);
    y += 26;
  });

  const a = document.createElement("a");
  a.download = "STMY_VD_WD_memo.png";
  a.href = canvas.toDataURL("image/png");
  a.click();
}




// å‰åŠ
createGroup("chocolate","ac",PRICE.chocolate);
createGroup("BB1","bb1",PRICE.BB1);
createRandom("random_first","rd1",RANDOM_PRICE_FIRST);

// å¾ŒåŠ
createGroup("poster","ps",PRICE.poster);
createRandom("random_second","rd2",RANDOM_PRICE_SECOND);

loadData();   
calc();


</script>

  <!-- ä¸­ç•¥ï¼šãƒ©ãƒ³ãƒ€ãƒ å•†å“ã®divãªã©ã®å¾Œ -->

<div class="creator">

  <a 
  href="https://twitter.com/intent/tweet?text=Valentine's Day ï¼† White Day POP UP STOREã®ã‚°ãƒƒã‚ºè³¼å…¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼%0Ahttps://ylocal-trhk.github.io/VD-WD-PUS/" 
  target="_blank" 
  rel="noopener" 
  class="creator-link"
>
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M18.244 2.25h3.308l-7.227 8.26L22.5 21.75h-6.594l-5.16-6.726-5.886 6.726H1.548l7.73-8.835L1.5 2.25h6.762l4.662 6.12 5.32-6.12Zm-1.16 17.52h1.833L7.62 4.125H5.655l11.43 15.645Z"/>
  </svg>
  <span>ã‚·ã‚§ã‚¢</span>
</a>

  <div>
    ä½œæˆè€…ï¼š
    <a href="https://x.com" target="_blank" rel="noopener" class="creator-link">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M18.244 2.25h3.308l-7.227 8.26L22.5 21.75h-6.594l-5.16-6.726-5.886 6.726H1.548l7.73-8.835L1.5 2.25h6.762l4.662 6.12 5.32-6.12Zm-1.16 17.52h1.833L7.62 4.125H5.655l11.43 15.645Z"/>
      </svg>
      <span>@yLocal_trhk</span>
    </a>
  </div>

<div class="home-back">
  <a href="https://ylocal-trhk.github.io/HOME/" class="home-link">
    â† HOMEã«æˆ»ã‚‹
  </a>
</div>

</div>

</body>
</html>